# =============================================================================
# SIMPLIFIED ALSA Configuration - No Loopback Devices
# =============================================================================
# This configuration removes all snd-aloop loopback device support and
# provides direct hardware access with shared device capabilities.
#
# Key features:
# - Direct hardware access to physical devices
# - Shared microphone access via dsnoop
# - Mixed playback via dmix
# - Software volume control
# - No virtual loopback dependencies
# =============================================================================

# Global ALSA Settings
defaults.pcm.rate_converter "linear"

# =============================================================================
# Physical Speaker Device
# =============================================================================
pcm.spk
{
    type plug
    slave {
        pcm "hw:tas2563audio,0"
        rate 48000
        channels 2
        format S16_LE
    }
    hint {
        show on
        description "Physical Speaker with Format Conversion"
    }
}

# Control interface for speaker
ctl.spk {
    type hw
    card tas2563audio
}

# =============================================================================
# Physical Microphone Device (Shared)
# =============================================================================
pcm.mic_shared
{
    type dsnoop
    ipc_key 1004
    ipc_key_add_uid true              # Prevent conflicts between users
    ipc_perm 0666                     # Proper permissions
    slave {
        pcm "hw:micfilaudio,0"
        format S16_LE
        rate 16000
        channels 1
        buffer_size 2048
        period_size 512
        periods 8
    }
    bindings.0 0                      # Explicit channel binding
}

# Convenience aliases for microphone access
pcm.mic { 
    type plug
    slave.pcm "mic_shared"
}

pcm.wakeword { 
    type plug
    slave.pcm "mic_shared"
}

# Control interface for microphone
ctl.mic {
    type hw
    card micfilaudio
}

# =============================================================================
# Audio Mixing Device (Direct to Speaker)
# =============================================================================
pcm.mix
{
    type dmix
    ipc_key 1001
    ipc_key_add_uid true              # Prevent conflicts between users
    ipc_perm 0666                     # Proper permissions
    slave {
        pcm "spk"
        format S16_LE
        rate 48000
        channels 2
        buffer_size 2048
        period_size 512
        periods 8
    }
    bindings {
        0 0                           # Explicit channel bindings
        1 1
    }
}

# =============================================================================
# Software Volume Control
# =============================================================================
pcm.softvol {
    type            softvol
    slave {
        pcm         "mix"
    }
    control {
        name        "PCM"
        card        0
        count       2                 # Stereo volume control
    }
    min_dB          -51.0             # Minimum volume in dB
    max_dB          0.0               # Maximum volume in dB
    resolution      256               # Volume resolution steps
}

# =============================================================================
# Default Audio Device
# =============================================================================
pcm.!default
{
    type asym
    playback.pcm "plug:softvol"
    capture.pcm "plug:mic_shared"
    hint {
        show on
        description "Default Audio Device - Direct Hardware Access"
    }
}

# =============================================================================
# Additional Monitoring and Testing Devices
# =============================================================================

# Monitor device for debugging
pcm.monitor
{
    type file
    slave.pcm "mic_shared"
    file "/tmp/alsa_capture_monitor.wav"
    format "wav"
}

# Raw physical devices for testing
pcm.raw_mic
{
    type hw
    card micfilaudio
    device 0
    hint {
        show on
        description "Raw Physical Microphone"
    }
}

pcm.raw_speaker
{
    type hw
    card tas2563audio
    device 0
    hint {
        show on
        description "Raw Physical Speaker"
    }
}

# =============================================================================
# Control Interface
# =============================================================================
ctl.!default {
    type hw
    card 0
}
